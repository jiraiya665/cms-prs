{"additions": 1163, "auther_ref": "CMSSW_10_6_X_tau-pog_DeepTau2017v2", "auther_sha": "9bdaa99a4fa33012653644b04d7548ffcc5852da", "author": "cms-tau-pog", "body": "#### PR description:\r\n\r\nThis PR updates DeepTauID to version 2017v2. The new version, thanks to revised structure of used DNN, fixes issues of version 2017v1, that is a size of a training file and memory consumption are greatly reduced.  Possibility to run previous version is maintained.\r\n\r\nQuantitative summary (with 1k ttbar events, details below):\r\n* size of training file: 4.6MiB (was 21MiB)\r\n* memory consumption: on top of DeepJet: 6.4MiB or 21.5 MiB standalone. The difference between the two comes mainly from executing `pat::PackedCandidate::dzError()` method which triggers unpacking of track covariance matrix and at smaller extend from initialization of TensorFlow. IGProf outputs below.\r\n* CPU timing: total timing is 249.11s, the DeeTau::Produce function takes 219.74s to process 1k ttbar events, so as a frequency of 4.55Hz.\r\n\r\nIn addition the new v2 training overperforms old one as well as other TauIDs, details in slides:\r\n[1] https://indico.cern.ch/event/816162/contributions/3408556/attachments/1835352/3007877/2019-04-29_DeepTau_ID_v2_developments.pdf\r\n[2] https://indico.cern.ch/event/818643/contributions/3422014/attachments/1839253/3014630/2019-05-06_DeepTau_ID_v2_WP.pdf\r\n\r\n**Note 1:** this PR is meant to be backported to 10_6_X for UL processing and 10_2_X for using with current Run-2 samples.\r\n**Note 2:** this PR is completed by PR to cms-data https://github.com/cms-data/RecoTauTag-TrainingFiles/pull/3 which needs to be propagated to cms-dist\r\n**Note 3:** it is planned to add DeepTau 2017v2 to MiniAOD workflow with 11_0_X and 10_6_X (UL) when this PR accepted by RECO\r\n\r\n#### PR validation:\r\n\r\nDeepTauID is not a part of any official CMSSW worflow. Therefore, it is tested with a standalone configuration file (on top of MiniAOD): RecoTauTag/RecoTau/test/runDeepTauIDsOnMiniAOD.py\r\nThe test were preformed with 1k of ttbar events. \r\n\r\nDetails on CPU timing:\r\nhttps://github.com/cms-tau-pog/cmssw/files/3166833/DeepTauCPU.txt.gz\r\n\r\nMemory consumption: \r\n* On top of DeepJet: 6.4 MiB, calculated as the sum of the three biggest contributions:\r\n1. DeepTauId::getPredictions = 3.23 MiB\r\n2. deep_tau::DeepTauBase::initializeGlobalCache = 2.73 MiB\r\n3. DeepTauId::DeepTauId = 0.41 MiB\r\n\r\nIGProf output: https://github.com/cms-tau-pog/cmssw/files/3183153/igprof-analyse-DeepTau_deepJet.txt.gz\r\n\r\n* Standalone: 21.5 MiB, calculated as the sum of the three biggest contributions:\r\n1. DeepTauId::getPredictions = 17.2 MiB\r\n2. deep_tau::DeepTauBase::initializeGlobalCache = 3.9 MiB\r\n3. DeepTauId::DeepTauId = 0.4 MiB\r\n\r\nIGProf output: https://github.com/cms-tau-pog/cmssw/files/3172207/igprof-analyse-DeepTau_mem_mapped.txt.gz\r\n\r\n#### if this PR is a backport please specify the original PR:\r\n\r\nN/A", "branch": "master", "changed_files": 8, "comments": 39, "commits": 52, "created_at": "1557992884", "deletions": 56, "labels": ["analysis-pending", "code-checks-approved", "comparison-pending", "orp-pending", "pending-signatures", "reconstruction-pending", "requires-external", "simulation-pending", "tests-started"], "milestone": "CMSSW_11_0_X", "number": 26796, "release-notes": [], "review_comments": 0, "state": "open", "title": "Update of DeepTauID to ver. 2017v2", "updated_at": "1558107115", "user": "mbluj"}